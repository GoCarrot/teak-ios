machine:
  xcode:
    version: 8.2.1
deployment:
  prod:
    branch: master
    commands:
      - (cd build; zip --symlinks -r Teak.framework.zip Teak.framework/)
      - aws s3 cp build/Teak.framework.zip s3://teak-build-artifacts/ios/Teak-`cat VERSION`.framework.zip --acl public-read --recursive
      - aws s3 cp build/Teak.framework.zip s3://teak-build-artifacts/ios/Teak.framework.zip --acl public-read --recursive
compile:
  override:
  - ./compile
dependencies:
  pre:
  - ./setup
test:
  override:
    - set -o pipefail &&
      xcodebuild
        CODE_SIGNING_REQUIRED=NO
        CODE_SIGN_IDENTITY=
        PROVISIONING_PROFILE=
        -sdk iphonesimulator
        -destination 'platform=iOS Simulator,OS=10.0,name=iPhone 6'
        -scheme Teak
        clean build |
      tee $CIRCLE_ARTIFACTS/xcode_raw.log |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml
