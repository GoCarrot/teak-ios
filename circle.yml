machine:
  xcode:
    version: 8.2.1
checkout:
  post:
    - git fetch --tags
deployment:
  prod:
    branch: master
    commands:
      - aws s3 cp build/Release-iphoneos/Teak.framework.zip s3://teak-build-artifacts/ios/Teak-$(git describe --tags --always).framework.zip --acl public-read
      - aws s3 cp build/Release-iphoneos/Teak.framework.zip s3://teak-build-artifacts/ios/Teak.framework.zip --acl public-read
compile:
  override:
  - ./compile
dependencies:
  pre:
  - brew update # Fixes: Homebrew must be run under Ruby 2.3!
  - ./setup
test:
  override:
    - set -o pipefail &&
      xcodebuild
        CODE_SIGNING_REQUIRED=NO
        CODE_SIGN_IDENTITY=
        PROVISIONING_PROFILE=
        -sdk iphonesimulator
        -destination 'platform=iOS Simulator,OS=10.0,name=iPhone 6'
        -scheme Teak
        clean build |
      tee $CIRCLE_ARTIFACTS/xcode_raw.log |
      xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml
    - ./framework-sanity
